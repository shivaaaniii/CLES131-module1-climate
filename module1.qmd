---
title: "Module 1: Climate change"
format: pdf
editor: source
editor_options: 
  chunk_output_type: console
---

```{r}
#| warning: false
library(tidyverse)
```

### Use of GitHub

Link to your forked GH repository: https://github.com/shivaaaniii/CLES131-module1-climate

### Use of Quarto

Link to your .qmd file: https://github.com/shivaaaniii/CLES131-module1-climate/edit/main/module1.qmd

## CO2 trends from Mauna Loa

We will begin at the global scale by plotting the famed Mauna Loa CO~2~ curve at monthly intervals, with the twin objectives of (1) making layered plots with 'ggplot2', a package within the 'tidyverse' collection widely adopted by the R data science community, and (2) refreshing understanding of the seasonal cycle in atmospheric \[CO~2~\].

With data you've collected yourself, it is more common to store locally as a csv. However, we can use tidyverse tools to read directly from files stored online and will do so here to get the latest data.

```{r}
#| warning: false
#| output: false
co2 <-read_table("https://gml.noaa.gov/webdata/ccgg/trends/co2/co2_mm_mlo.txt", 
                  comment="#",
                  col_names = c("year", "month", "decimal_date", "average",
                                "interpolated", "trend", "days"),
                  na = c("-1", "-99.99"))
```

You can examine these data in several ways. One option is to use your mouse in the Environment tab and click on the dataset name. Alternatively, you can type `View(co2)` in your console to achieve the same outcome. Below are some other common options to understand the data structure at a glance.

```{r}
str(co2)
head(co2)
```

### Q1 (1 point)

Create a timeseries plot of average \[CO~2~\]. Use `as.Date()` to create a formatted date for the x-axis. Label both the y-axis and add a line to connect the points.

```{r}
# Create a new date column using year and month
co2 <- co2 %>%
  mutate(date = as.Date(paste(year, month, 15, sep = "-")))  # Use 15th as middle of month

# Plot average CO2 over time
ggplot(co2, aes(x = date, y = average)) +
  geom_line(color = "green") +
  labs(
    title = "Monthly Average Atmospheric CO₂ at Mauna Loa",
    x = "Year",
    y = "Average CO₂ (ppm)"
  ) 
```

### Q2 (1 point)

What months are the \[CO~2~\] values at the maximum? Create another dataframe with these months selected and create a plot like above, but with the maximum months colored in "forestgreen".

```{r}
max_months <- co2 %>%
  group_by(year) %>%
  filter(average == max(average, na.rm = TRUE)) %>%
  ungroup()
ggplot(co2, aes(x = date, y = average)) +
  geom_line(color = "grey") +
  geom_point(data = max_months, aes(x = date, y = average), color = "forestgreen", size = 1.5) +
  labs(
    title = "Monthly CO₂ with Maximum Months Highlighted",
    x = "Year",
    y = "Average CO₂ (ppm)"
  )
```

### Q3 (1 point)

What explains the seasonal variation in \[CO~2~\]? After reading Lewandowsky et al. 2016, how might you go about separating the long term trend and the seasonal variation in \[CO~2~\]?

Seasonal Variation is based on natural plant processes of growth and decay. To separate long term trends and seasonal variation,  decomposition methods can be used.


## Global temperature

Next, we turn to a global temperature anomaly [dataset](https://data.giss.nasa.gov/gistemp/graphs/graph_data/Global_Mean_Estimates_based_on_Land_and_Ocean_Data/graph.txt) from NASA GISS, similar to the GMST used by Lewandowsky et al. 2016.

### Q4 (1 point)

Read some [background](https://data.giss.nasa.gov/gistemp/history/background.html) as well as the [simplified documentation](https://climate.nasa.gov/vital-signs/global-temperature/?intent=121) for this dataset.

How are the measurements made? Describe each column in the dataset and its units. What are the resolution of the data?

The data set estimates changes in global surface temperature using a network of meteorological stations, sea surface temperature measurements, and satellite observations. The columns represent year and temperature anomaly. The temporal resolution of the data set is annual, providing one data point per year. The spatial resolution of the data set is a global average. 

### Q5 (1 point)

Construct code to import dataset in a format that can be used for transforming and visualization.

```{r}
{r}
temp <- read_table(
  "https://data.giss.nasa.gov/gistemp/graphs/graph_data/Global_Mean_Estimates_based_on_Land_and_Ocean_Data/graph.txt",
  skip = 5,
  col_names = c("year", "anomaly")
)
```

### Q6 (1 point)

Plot the trend in global mean temperature over time. Describe what you see and how you interpret the patterns you observe.

```{r}
ggplot(temp, aes(x = year, y = anomaly)) +
  geom_line(color = "red", size = 1) +
  geom_smooth(method = "loess", se = FALSE, color = "blue") +
  labs(
    title = "Global Mean Temperature Anomaly (1880–Present)",
    x = "Year",
    y = "Temperature Anomaly (°C, relative to 1951–1980)"
  )
```
### Q7 (1 point)

Consider the "pause" analyzed in Lewandowsky et al. 2016. Do you see evidence for such a pause?

The pause refers to a slower rate of global temperature increase, but was not a real slowdown in warming. When considering longer timeframes or accounting for natural variability, the warming trend continues. 1998 was a strong El Niño year, but there is still an overall increase in temperature. 

### Bonus 1 (1 point)

Recreate the analysis from Lewandowsky's Fig. 1.

## Long term records of CO2

The data from Mauna Loa go back as far as modern instrumentation. To put these values into geological perspective, we must go back much further than humans have been monitoring \[CO~2~\]. Ice sheets contain layers of snow with trapped air bubbles and can be cored and dated like tree rings.

Previously hosted by Oak Ridge National Lab, the [data](https://zenodo.org/records/3678928) associated with the famed Vostok Ice Core is now archived on Zenodo. Skim [Barnola et al. 1987](https://www.nature.com/articles/329408a0) as needed.

### Q8 (1 point)

After downloading this dataset, create a folder entitled `data` and save the file within the folder with a .txt extension. Read this file into R. What are the columns and units? How were these data obtained?

The dataset columns include depth(meters), ice age(years), air age(years), and CO2 concentration(parts per million per volume). The data was obtained by drilling deep cores into antarctic ice sheets. Each layer of snow was compacted into ice and trapped tiny air bubbles, which can be used to measure past atmospheric CO2. 

### Q9 (1 point)

Transform the data as needed to create a plot in chronological order. Add at least two different smoothing window averages to your plot.

```{r}
colnames(vostok)


vostok <- read_table("data/vostok.icecore.txt", comment = "#")

vostok <- vostok %>%
  arrange(Age_air)
install.packages("zoo")
library(zoo)
vostok <- vostok %>%
  mutate(
    rollmean_500 = rollmean(CO2, k = 500, fill = NA, align = "center"),
    rollmean_2000 = rollmean(CO2, k = 2000, fill = NA, align = "center")
  )
ggplot(vostok, aes(x = Age_air, y = CO2)) +
  geom_line(color = "gray", alpha = 0.7) +                      # Raw data
  geom_line(aes(y = rollmean_500), color = "blue", size = 1) +    # 500-year smooth
  geom_line(aes(y = rollmean_2000), color = "red", size = 1) +    # 2000-year smooth
  scale_x_reverse() +                                              # So time runs from past → present left to right
  labs(
    title = "Vostok Ice Core CO2 Concentration Over Time",
    x = "Years Before Present",
    y = expression("CO"[2]*" concentration (ppmv)"),
    caption = "Raw data (gray), 500-year rolling average (blue), 2000-year rolling average (red)"
  )
```

### Q10 (1 point)

Join your data with the Mauna Loa data and plot together, considering different colors for the different datasets.

```{r}
vostok <- vostok %>%
  mutate(calendar_year = 1950 - Age_air)
mauna_prepared <- co2 %>%
  filter(!is.na(average)) %>%
  mutate(calendar_year = decimal_date) %>%
  select(calendar_year, CO2 = average) %>%
  mutate(dataset = "Mauna Loa")

# Prepare Vostok data
vostok_prepared <- vostok %>%
  filter(!is.na(CO2)) %>%
  mutate(calendar_year = 1950 - Age_air) %>%
  select(calendar_year, CO2) %>%
  mutate(dataset = "Vostok Ice Core")

# Combine datasets
combined_data <- bind_rows(mauna_prepared, vostok_prepared)

ggplot(combined_data, aes(x = calendar_year, y = CO2, color = dataset)) +
  geom_line() +
  scale_x_continuous(
    trans = "reverse",  # reverse x-axis so past (older) on left, recent on right
    name = "Year"
  ) +
  labs(
    title = "Atmospheric CO2 Concentrations: Vostok Ice Core vs. Mauna Loa",
    y = expression("CO"[2]*" concentration (ppmv)"),
    color = "Dataset"
  )
```

### Bonus 2 (1 point)

Write a catchy title and short description in the style of a NYtimes infographic, contrasting the rate of anthropogenic vs. background climate change for a general public audience.

Here's how human activity is impacting climate change: A Timeline of CO2
